<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <property name="now" value="sysdate" dbms="oracle"/>
    <property name="now" value="now()" dbms="postgresql"/>

    <changeSet author="tanmay.p" id="201701091530">
        <createTable tableName="USER_DETAILS">
            <column name="id" type="VARCHAR2(255)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_name" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="client_wallet_account_id" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="client_device_id" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="payment_app_instance_id" type="VARCHAR2(255)"/>
            <column name="user_status" type="VARCHAR2(255)"/>
            <column name="activation_code" type="VARCHAR2(255)"/>
        </createTable>
        <addUniqueConstraint columnNames="user_name" constraintName="unique_constraints"
                             tableName="user_details" deferrable="false"/>
        <createIndex tableName="USER_DETAILS" indexName="user_details_id" unique="true">
            <column name="id"/>
            <column name="user_name"/>
        </createIndex>

        <!-- Table for device management-->
        <createTable tableName="DEVICE_INFO">
            <column name="id" type="VARCHAR2(255)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="payment_app_instance_id" type="VARCHAR2(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="payment_app_id" type="VARCHAR2(255)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="rns_registration_id" type="VARCHAR2(1024)"/>
            <column name="OS_NAME" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
            <column name="OS_VERSION" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
            <column name="NFC_CAPABLE" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
            <column name="IMEI" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>

            <!-- VISA specific columns -->
            <column name="CLIENT_DEVICE_ID" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
            <column name="V_CLIENT_ID" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>

            <column name="DEVICE_MODEL" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
            <column name="HOST_DEVICE_ID" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>

            <!-- visa device/vts certs start-->
        <!---    <column name="vtscerts_vcertificateid_confidentiality" type="VARCHAR2(11600)">
                <constraints nullable="true"/>
            </column>
            <column name="vtscerts_certusage_confidentiality" type="VARCHAR2(11600)">
                <constraints nullable="true"/>
            </column>
            <column name="vtscerts_vcertificateid_integrity" type="VARCHAR2(11600)">
                <constraints nullable="true"/>
            </column>
            <column name="vtscerts_certusage_integrity" type="VARCHAR2(11600)">
                <constraints nullable="true"/>
            </column>

            <column name="devicecerts_certvalue_confidentiality" type="VARCHAR2(11600)">
                <constraints nullable="true"/>
            </column>
            <column name="devicecerts_certusage_confidentiality" type="VARCHAR2(11600)">
                <constraints nullable="true"/>
            </column>
            <column name="devicecerts_certformat_confidentiality" type="VARCHAR2(11600)">
                <constraints nullable="true"/>
            </column>

            <column name="devicecerts_certvalue_integrity" type="VARCHAR2(11600)">
                <constraints nullable="true"/>
            </column>
            <column name="devicecerts_certusage_integrity" type="VARCHAR2(11600)">
                <constraints nullable="true"/>
            </column>
            <column name="devicecerts_certformat_integrity" type="VARCHAR2(11600)">
                <constraints nullable="true"/>
            </column>-->

            <column name="vserver_nonce" type="VARCHAR2(600)">
                <constraints nullable="true"/>
            </column>
            <!--visa device/vts certs end-->

            <!-- added madan-->
            <column name="VISA_ENABLED" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
            <column name="MASTERCARD_ENABLED" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
            <column name="VISA_MESSAGE" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
            <column name="MASTERCARD_MESSAGE" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
            <column name="DEVICE_STATUS" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
            <!--add by madan-->
        </createTable>
        <addUniqueConstraint columnNames="IMEI" constraintName="device_unique_constraints" deferrable="true"
                             tableName="DEVICE_INFO"/>
        <createIndex tableName="DEVICE_INFO" indexName="device_info_id" unique="true">
            <column name="id"/>
            <column name="IMEI"/>
        </createIndex>

        <!-- Table for Card management-->
        <createTable tableName="CARD_DETAILS">
            <column name="id" type="VARCHAR2(255)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="payment_app_instance_id" type="VARCHAR2(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="TOKEN_UNIQUE_REFERENCE" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="PAN_UNIQUE_REFERENCE" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="TOKEN_INFO" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="TOKEN_STATUS" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addUniqueConstraint columnNames="TOKEN_UNIQUE_REFERENCE" constraintName="card_unique_constraints"
                             deferrable="true"
                             tableName="CARD_DETAILS"/>
        <createIndex tableName="CARD_DETAILS" indexName="card_info_id" unique="true">
            <column name="id"/>
            <column name="payment_app_instance_id"/>
            <column name="TOKEN_UNIQUE_REFERENCE"/>
        </createIndex>

        <createTable tableName="SERVICE_DATA">
            <column name="id" type="VARCHAR2(255)">
                <constraints nullable="true" primaryKey="true"/>
            </column>
            <column name="service_id" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
            <column name="request" type="BLOB">
                <constraints nullable="true"/>
            </column>
            <column name="response" type="BLOB">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <addUniqueConstraint columnNames="service_id" constraintName="service_unique_constraints" deferrable="true"
                             tableName="SERVICE_DATA"/>
        <createIndex tableName="SERVICE_DATA" indexName="service_id" unique="true">
            <column name="id"/>
            <column name="service_id"/>
        </createIndex>

        <!-- Table for  visa Card management-->
        <createTable tableName="CARD_DETAILS_VISA">
            <column name="id" type="VARCHAR2(255)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="user_name" type="VARCHAR2(255)">
                <constraints nullable="false" foreignKeyName="fk_user_device_detail"
                             references="USER_DETAILS(user_name)"/>
            </column>
            <column name="cardnumberSuffix" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="vpanenrollmentid" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="STATUS" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addUniqueConstraint columnNames="vpanenrollmentid" constraintName="vpanenrollmentid_constraints"
                             deferrable="true"
                             tableName="CARD_DETAILS_VISA"/>
        <createIndex tableName="CARD_DETAILS_VISA" indexName="visa_card_info_id" unique="true">
            <column name="id"/>
            <column name="user_name"/>
            <column name="vpanenrollmentid"/>
            <column name="cardnumberSuffix"/>
        </createIndex>

        <!--Transaction details table-->
        <createTable tableName="TRANSACTION_REG_DETAILS">
            <column name="id" type="VARCHAR2(255)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="payment_app_instance_id" type="VARCHAR2(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="TOKEN_UNIQUE_REFERENCE" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="REG_CODE_1" type="VARCHAR2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="REG_CODE_2" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
            <column name="AUTH_CODE" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
            <column name="TDS_URL" type="VARCHAR2(255)">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <addUniqueConstraint columnNames="TOKEN_UNIQUE_REFERENCE" constraintName="tokenuniqueRef_constraints"
                             tableName="TRANSACTION_REG_DETAILS" deferrable="false"/>
        <createIndex tableName="TRANSACTION_REG_DETAILS" indexName="TRANSACTION_REG_DETAILS_ID" unique="true">
            <column name="id"/>
            <column name="TOKEN_UNIQUE_REFERENCE"/>
        </createIndex>
    </changeSet>


    <changeSet author="tanmay.p" id="201701091531">
    <createTable tableName="SYS_MESSAGES">
        <column name="BEARER" type="VARCHAR2(255)">
            <constraints nullable="true"/>
        </column>
        <column name="MESSAGE" type="VARCHAR2(255)">
            <constraints nullable="false"/>
        </column>
        <column name="MESSAGE_CODE" type="VARCHAR2(255)">
            <constraints nullable="false"/>
        </column>
        <column name="LANGUAGE_CODE" type="VARCHAR2(255)">
            <constraints nullable="false"/>
        </column>
    </createTable>
        <addPrimaryKey columnNames="MESSAGE_CODE, LANGUAGE_CODE" constraintName="PK_MESSAGE" tableName="SYS_MESSAGES" />
    </changeSet>


    <changeSet author="tanmay.p" id="sqlFileInsert">
        <sqlFile path="dbChangelog\mdes-vts.sql"/>
    </changeSet>

</databaseChangeLog>